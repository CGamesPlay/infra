terraform-infra:
  summary: ensure that all cloud resources are up to date
  command: terraform -chdir={{ .robo.path }}/infra "$@" -var-file=$TF_WORKSPACE.tfvars
  examples:
    - description: Preview infrastructure changes
      command: robo terraform-infra plan
    - description: Apply infrastructure changes
      command: robo terraform-infra apply

master_ip:
  command: robo -c {{ .robo.file }} terraform-infra output -raw master_ip

ansible:
  summary: sync all configuration files on all servers
  command: ansible-playbook -u ubuntu -i $(robo -c {{ .robo.file }} master_ip), -e DC=nbg1 -e wireguard_ip={{ .wireguard_ip }} ansible/site.yml "$@"
  examples:
    - description: Preview changes
      command: robo ansible -CD
    - description: Apply changes
      command: robo ansible

verify:
  summary: Verify that services are all working
  command: ansible-playbook -u ubuntu -i $(robo -c {{ .robo.file }} master_ip), -e DC=nbg1 -e wireguard_ip={{ .wireguard_ip }} ansible/playbooks/verify.yml "$@"

variables:
  wireguard_ip: 172.30.0.1
